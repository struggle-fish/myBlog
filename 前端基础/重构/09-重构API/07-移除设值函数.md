# 移除设值函数

## 示意图

![LOGO](/public/image/refactoring/RemoveSettingMethod.png)

## 动机

如果为某个字段提供了设值函数，这就暗示这个字段可以被改变。

如果不希望在对象创建之后此字段还有机会被改变，那就不要为它提供设值函数（同时将该字段声明为不可变）​。


这样一来，该字段就只能在构造函数中赋值，我“不想让它被修改”的意图会更加清晰，并且可以排除其值被修改的可能性——这种可能性往往是非常大的。


一种情况是，有些人喜欢始终通过访问函数来读写字段值，包括在构造函数内也是如此。这会导致构造函数成为设值函数的唯一使用者。若果真如此，我更愿意去除设值函数，<sapn class="marker-text">清晰地表达“构造之后不应该再更新字段值”的意图。</sapn>


另一种情况是，对象是由客户端通过创建脚本构造出来，而不是只有一次简单的构造函数调用。所谓“创建脚本”​，首先是调用构造函数，然后就是一系列设值函数的调用，共同完成新对象的构造。创建脚本执行完以后，这个新生对象的部分（乃至全部）字段就不应该再被修改。设值函数只应该在起初的对象创建过程中调用。对于这种情况，我也会想办法去除设值函数，更清晰地表达我的意图。




## 做法

- 如果构造函数尚无法得到想要设入字段的值，就使用[改变函数声明（124）](../目录.md#改变函数声明-124)将这个值以参数的形式传入构造函数。在构造函数中调用设值函数，对字段设值。

- 移除所有在构造函数之外对设值函数的调用，改为使用新的构造函数。每次修改之后都要测试。

- 使用[内联函数（115）](../目录.md#内联函数-115)消去设值函数。如果可能的话，把字段声明为不可变。



## 范例


::: code-group

```js [源]

class Person {
  get name() {
    return this._name;
  } 
  set name(arg) {
    this._name = arg;
  } 
  get id() {
    return this._id;
  }
  set id(arg) {
    this._id = arg;
  }
}
对象创建之后，name字段可能会改变，
但id字段不会。为了更清晰地表达这个设计意图，
我希望移除对应id字段的设值函数。
// 对象创建
const martin = new Person(); 
martin.name = "martin"; 
martin.id = "1234";

```

```js [移除设值函数]

但id字段还得设置初始值，
所以我首先用改变函数声明（124）在构造函数中添加对应的参数。

class Person {
  constructor(id) { // [!code ++]
    this.id = id; // [!code ++]
  } // [!code ++]
  get name() {
    return this._name;
  } 
  set name(arg) {
    this._name = arg;
  } 
  get id() {
    return this._id;
  }
  set id(arg) { // [!code --]
    this._id = arg; // [!code --]
  } // [!code --]
}

```

:::