# 三层架构


## 问题分析

上述案例的功能，虽然已经实现，但是呢，会发现案例中：
解析文本文件中的数据，处理数据的逻辑代码，
给页面响应的代码全部都堆积在一起了，
全部都写在`controller`方法中了。


![LOGO](/public/image/javapublic/7c0f3d0a-a83b-46c5-aa59-c3c2b4c443c5.png)

当前程序的这个业务逻辑还是比较简单的，如果业务逻辑再稍微复杂一点，我们会看到Controller方法的代码量就很大了。
- 当我们要修改操作数据部分的代码，需要改动Controller
- 当我们要完善逻辑处理部分的代码，需要改动Controller
- 当我们需要修改数据响应的代码，还是需要改动Controller

这样呢，就会造成我们整个工程代码的复用性比较差，而且代码难以维护。 
那如何解决这个问题呢？其实在现在的开发中，有非常成熟的解决思路，那就是`分层开发`。 


## 三层架构


进行程序设计以及程序开发时，尽可能让每一个接口、类、方法的职责更单一些（单一职责原则）。

单一职责原则：一个类或一个方法，就只做一件事情，只管一块功能。

这样就可以让类、接口、方法的复杂度更低，可读性更强，扩展性更好，也更利于后期的维护。


之前开发的程序呢，并不满足单一职责原则。


![LOGO](/public/image/javapublic/f12ee3f6-1852-4e28-acf3-25454b2e97cf.png)


上述案例的处理逻辑，从组成上看可以分为三个部分：
- 数据访问：负责业务数据的维护操作，包括增、删、改、查等操作。
- 逻辑处理：负责业务逻辑处理的代码。
- 请求处理、响应数据：负责，接收页面的请求，给页面响应数据。

按照上述的三个组成部分，在我们项目开发中呢，可以将代码分为三层，如图所示：

![LOGO](/public/image/javapublic/77ba8ac6-5f77-4993-8cb7-cbc1e3ada64b.png)


- Controller：控制层。接收前端发送的请求，对请求进行处理，并响应数据。
- Service：业务逻辑层。处理具体的业务逻辑。
- Dao：数据访问层(Data Access Object)，也称为持久层。负责数据访问操作，包括数据的增、删、改、查。

基于三层架构的程序执行流程，如图所示：

![LOGO](/public/image/javapublic/41d3339a-c1af-49f9-b748-075c336ef46c.png)

- 前端发起的请求，由Controller层接收（Controller响应数据给前端）
- Controller层调用Service层来进行逻辑处理（Service层处理完后，把处理结果返回给Controller层）
- Serivce层调用Dao层（逻辑处理过程中需要用到的一些数据要从Dao层获取）
- Dao 层操作文件中的数据（Dao拿到的数据会返回给Service层）




### 代码实现

使用三层架构思想，来改造下之前的程序：
- 控制层包名：com.xxx.controller : 接收前端发送的请求，对请求进行处理，并响应数据
- 业务逻辑层包名：com.xxx.service
- 数据访问层包名：com.xxx.dao


::: code-group

```java[控制层]
// com.example.controller 中创建UserController类
package com.example.controller;


import com.example.pojo.User;
import com.example.service.IUserService;
import com.example.service.impl.UserServiceImpl;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.io.FileNotFoundException;
import java.util.List;

@RestController
public class UserController {
    
    private UserService userService = new UserServiceImpl();

    @RequestMapping("/list")
    public List<User> list(){
        //1.调用Service
        List<User> userList = userService.findAll();
        //2.响应数据
        return userList;
    }

}


```

```java[业务逻辑层]
// 在 com.example.service中创建UserSerivce接口
package com.example.service;

import com.example.pojo.User;
import java.util.List;

public interface UserService {

   public List<User> findAll();

}

```

```java[UserServiceImpl实现类]

// 在 com.example.service.impl 中创建UserSerivceImpl

package com.example.service.impl;

import com.example.dao.UserDao;
import com.example.dao.impl.UserDaoImpl;
import com.example.pojo.User;
import com.example.service.UserService;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.List;
import java.util.stream.Collectors;

public class UserServiceImpl implements UserService {

    private UserDao userDao = new UserDaoImpl();

    @Override
    public List<User> findAll() {
        List<String> lines = userDao.findAll();
        List<User> userList = lines.stream().map(line -> {
            String[] parts = line.split(",");
            Integer id = Integer.parseInt(parts[0]);
            String username = parts[1];
            String password = parts[2];
            String name = parts[3];
            Integer age = Integer.parseInt(parts[4]);
            LocalDateTime updateTime = LocalDateTime.parse(
                parts[5],
                DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));
            return new User(
                id, 
                username, 
                password, 
                name, 
                age, 
                updateTime
            );
        }).collect(Collectors.toList());
        return userList;
    }
}

```

```java [UserDao接口]
// 在 com.example.dao中创建UserDao接口
package com.example.dao;

import java.util.List;

public interface UserDao {

    public List<String> findAll();

}

```
```java[UserDaoImpl实现类]

// 在 com.example.dao.impl 中创建UserDaoImpl接口
package com.example.dao.impl;

import cn.hutool.core.io.IoUtil;
import com.example.dao.UserDao;

import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.List;

public class UserDaoImpl implements UserDao {
    @Override
    public List<String> findAll() {
        InputStream in = this.getClass()
                            .getClassLoader()
                            .getResourceAsStream("user.txt");
        ArrayList<String> lines = IoUtil.readLines(
                in,
                StandardCharsets.UTF_8,
                new ArrayList<>()
              );
        return lines;
    }
}
```

:::



具体的请求调用流程：

![LOGO](/public/image/javapublic/094beb44-9a9f-4b7d-82a8-2d18514912d6.png)


三层架构的好处:


![LOGO](/public/image/javapublic/WX20250430-204128@2x.png)


















































































